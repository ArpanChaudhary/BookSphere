<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Catalog - BookSphere</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/main.css}">
</head>
<body>
    <!-- Header -->
    <div th:replace="fragments/header :: header"></div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div th:replace="fragments/sidebar :: sidebar(currentPage='books')"></div>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Book Catalog</h1>
                </div>

                <!-- Search and Filter -->
                <div class="card mb-4">
                    <div class="card-body">
                        <form th:action="@{/books}" method="get" class="row g-3">
                            <div class="col-md-6">
                                <label for="search" class="form-label">Search Books</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="search" name="search" th:value="${search}" placeholder="Search by title, author, ISBN...">
                                    <button class="btn btn-primary" type="submit">
                                        <i class="bi bi-search"></i> Search
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="genreId" class="form-label">Filter by Genre</label>
                                <select class="form-select" id="genreId" name="genreId" onchange="this.form.submit()">
                                    <option value="">All Genres</option>
                                    <!-- Note: In a real application, you would populate this with genres from the database -->
                                    <option value="1" th:selected="${genreId == 1}">Fiction</option>
                                    <option value="2" th:selected="${genreId == 2}">Non-Fiction</option>
                                    <option value="3" th:selected="${genreId == 3}">Science Fiction</option>
                                    <option value="4" th:selected="${genreId == 4}">Fantasy</option>
                                    <option value="5" th:selected="${genreId == 5}">Mystery</option>
                                    <option value="6" th:selected="${genreId == 6}">Romance</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="clear" class="form-label">&nbsp;</label>
                                <a th:href="@{/books}" id="clear" class="btn btn-outline-secondary d-block">Clear Filters</a>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Book List -->
                <div class="row">
                    <div th:if="${books.empty}" class="col-12">
                        <div class="alert alert-info text-center" role="alert">
                            <h4 class="alert-heading">No Books Found</h4>
                            <p>Sorry, we couldn't find any books matching your criteria. Please try a different search or browse all books.</p>
                        </div>
                    </div>
                    
                    <div th:each="book : ${books}" class="col-md-6 col-lg-4 col-xl-3 mb-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title" th:text="${book.title}">Book Title</h5>
                                <h6 class="card-subtitle mb-2 text-muted" th:text="${book.author != null ? book.author.fullName : 'Unknown Author'}">Author Name</h6>
                                <p class="card-text small" th:text="${#strings.abbreviate(book.description, 100)}">Book description...</p>
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-primary me-2">Year: <span th:text="${book.publicationYear}">2023</span></span>
                                    <span th:each="genre : ${book.genres}" class="badge bg-secondary me-1" th:text="${genre.name}">Genre</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="text-primary fw-bold" th:text="'$' + ${#numbers.formatDecimal(book.rentalPrice, 1, 2)}">$10.00</span>
                                    <span th:if="${book.availableCopies > 0}" class="badge bg-success">Available</span>
                                    <span th:unless="${book.availableCopies > 0}" class="badge bg-danger">Out of Stock</span>
                                </div>
                            </div>
                            <div class="card-footer bg-white border-top-0">
                                <a th:href="@{/books/{id}(id=${book.id})}" class="btn btn-outline-primary w-100">View Details</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                <div th:if="${books.totalPages > 1}" class="d-flex justify-content-center mt-4">
                    <nav>
                        <ul class="pagination">
                            <li class="page-item" th:classappend="${books.first ? 'disabled' : ''}">
                                <a class="page-link" th:href="@{/books(page=${books.number - 1}, size=${books.size}, search=${search}, genreId=${genreId})}" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, books.totalPages - 1)}" 
                                th:classappend="${books.number == i ? 'active' : ''}">
                                <a class="page-link" th:href="@{/books(page=${i}, size=${books.size}, search=${search}, genreId=${genreId})}" th:text="${i + 1}">1</a>
                            </li>
                            <li class="page-item" th:classappend="${books.last ? 'disabled' : ''}">
                                <a class="page-link" th:href="@{/books(page=${books.number + 1}, size=${books.size}, search=${search}, genreId=${genreId})}" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/main.js}"></script>
    <script th:src="@{/js/bookSearch.js}"></script>
</body>
</html>
